(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{92567:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stake",function(){return __webpack_require__(99594)}])},99594:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return Trade}});var jsx_runtime=__webpack_require__(85893),index_02af91ae=__webpack_require__(18688),index_esm=__webpack_require__(83078),networkMapping=__webpack_require__(48036),PrismStaking=__webpack_require__(41616),subgraphQueries=__webpack_require__(69071),useQuery=__webpack_require__(16991),dist=__webpack_require__(41942),NFTBox=__webpack_require__(31717),react=__webpack_require__(67294),IpfsNft=__webpack_require__(97391),next_image=__webpack_require__(25675),image_default=__webpack_require__.n(next_image),lib_esm=__webpack_require__(35553);function StakeBox(param){let{nftAddress,tokenId,prismStakingAddress}=param,{isWeb3Enabled,account}=(0,index_esm.Nr)(),[imageURI,setImageURI]=(0,react.useState)(""),[tokenName,setTokenName]=(0,react.useState)(""),[earningInfo,setEarningInfo]=(0,react.useState)(null),dispatch=(0,dist.aa)(),formatter=Intl.NumberFormat("en",{notation:"compact"}),{runContractFunction:getTokenURI}=(0,index_esm.JX)({abi:IpfsNft,contractAddress:nftAddress,functionName:"tokenURI",params:{tokenId:tokenId}}),{runContractFunction:getEarningInfo}=(0,index_esm.JX)({abi:PrismStaking,contractAddress:prismStakingAddress,functionName:"earningInfo",params:{account:account,tokenIds:[tokenId]}}),{runContractFunction:unstake}=(0,index_esm.JX)({abi:PrismStaking,contractAddress:prismStakingAddress,functionName:"unstake",params:{tokenIds:[tokenId]}}),{runContractFunction:claim}=(0,index_esm.JX)({abi:PrismStaking,contractAddress:prismStakingAddress,functionName:"claim",params:{tokenIds:[tokenId]}}),handleUnstakeButtonClick=()=>{unstake({onError:error=>console.log(error),onSuccess:()=>handleUnstakeSuccess()})},handleClaimButtonClick=async()=>{await getEarningInfo(),claim({onError:error=>console.log(error),onSuccess:()=>handleClaimSuccess()})},handleUnstakeSuccess=()=>{dispatch({type:"success",message:"Item unstaked!",title:"Item Unstaked",position:"topR"})},handleClaimSuccess=()=>{dispatch({type:"success",message:"Tokens Claimed!",title:"Tokens Claimed",position:"topR"})};async function updateUI(){let tokenURI=await getTokenURI();if(tokenURI){let requestURL=tokenURI.replace("ipfs://","https://ipfs.io/ipfs/"),tokenURIResponse=await (await fetch(requestURL)).json(),imageURI=tokenURIResponse.image,imageURIURL=imageURI.replace("ipfs://","https://ipfs.io/ipfs/");setImageURI(imageURIURL),setTokenName(tokenURIResponse.name);let info=await getEarningInfo();setEarningInfo(lib_esm.dF(info.toString()))}}return(0,react.useEffect)(()=>{isWeb3Enabled&&updateUI()},[isWeb3Enabled]),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("div",{children:imageURI?(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("div",{className:"rounded-lg bg-gradient-to-r from-pink-500/50 via-red-500/50 to-yellow-500/50 p-[2px]",children:(0,jsx_runtime.jsx)("div",{className:"flex flex-col rounded-lg bg-[rgb(31,32,32)] mx-auto",children:(0,jsx_runtime.jsxs)("div",{className:"p-4 gap-2",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4",children:[(0,jsx_runtime.jsx)(image_default(),{alt:"pup",unoptimized:()=>imageURI,priority:!0,src:imageURI,height:"200",width:"200",className:"flex md:h-[200px] md:w-[200px] h-[150px] w-[150px] justify-start items-center mx-auto"}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-col justify-between ",children:[(0,jsx_runtime.jsxs)("div",{className:"flex flex-col md:items-center items-start",children:[(0,jsx_runtime.jsxs)("h3",{className:"md:text-2xl text-md font-bold text-slate-300",children:["Prism #",tokenId]}),"uncommon"==tokenName?(0,jsx_runtime.jsx)("h3",{className:"md:text-[10px] text-[8px] font-bold text-blue-300 pb-1",children:tokenName}):"rare"==tokenName?(0,jsx_runtime.jsx)("h3",{className:"md:text-[10px] text-[8px] font-bold text-purple-500 pb-1",children:tokenName}):"common"==tokenName?(0,jsx_runtime.jsx)("h3",{className:"md:text-[10px] text-[8px] font-bold text-gray-500 pb-1",children:tokenName}):"legendary"==tokenName?(0,jsx_runtime.jsx)("h3",{className:"md:text-[10px] text-[8px] text-orange-500 pb-1",children:tokenName}):(0,jsx_runtime.jsx)("p",{}),(0,jsx_runtime.jsx)("h3",{className:"flex justify-center text-md font-bold text-slate-300 pt-4",children:"$PRISM Earned"}),(0,jsx_runtime.jsx)("h3",{className:"flex justify-center md:text-4xl text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-br from-pink-400 to-red-600",children:earningInfo&&formatter.format(earningInfo)})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row gap-4 pb-1 md:visible invisible",children:[(0,jsx_runtime.jsx)("button",{type:"button",className:"flex items-center h-fit py-2 px-[20px] bg-gradient-to-r from-pink-500 to-orange-300 rounded-[32px] gap-[12px]",disabled:!isWeb3Enabled,onClick:handleUnstakeButtonClick,children:(0,jsx_runtime.jsx)("span",{className:"font-bold text-xs text-white",children:"Unstake"})}),(0,jsx_runtime.jsx)("button",{type:"button",className:"flex items-center h-fit py-2 px-[20px] bg-gradient-to-r from-pink-500 to-orange-300 rounded-[32px] gap-[12px]",disabled:!isWeb3Enabled,onClick:handleClaimButtonClick,children:(0,jsx_runtime.jsx)("span",{className:"font-bold text-xs text-white",children:"Claim"})})]})]})]}),(0,jsx_runtime.jsxs)("div",{className:"flex flex-row justify-center gap-4 py-4 pb-1 md:hidden",children:[(0,jsx_runtime.jsx)("button",{type:"button",className:"flex items-center h-fit py-2 px-[20px] bg-gradient-to-r from-pink-500 to-orange-300 rounded-[32px] gap-[12px]",disabled:!isWeb3Enabled,onClick:handleUnstakeButtonClick,children:(0,jsx_runtime.jsx)("span",{className:"font-bold text-xs text-white",children:"Unstake"})}),(0,jsx_runtime.jsx)("button",{type:"button",className:"flex items-center h-fit py-2 px-[20px] bg-gradient-to-r from-pink-500 to-orange-300 rounded-[32px] gap-[12px]",disabled:!isWeb3Enabled,onClick:handleClaimButtonClick,children:(0,jsx_runtime.jsx)("span",{className:"font-bold text-xs text-white",children:"Claim"})})]})]})})})}):(0,jsx_runtime.jsx)("div",{children:"Loading..."})})})}var styles=__webpack_require__(99176);function Trade(){let{switchNetwork}=(0,index_esm.Ab)(),{account,isWeb3Enabled,chainId}=(0,index_esm.Nr)(),prismStakingAddress=networkMapping[5].vW[0],marketplaceAddress=networkMapping[5].Wf[0],prismNftAddress=networkMapping[5].G3[0],[chainString,setChainString]=(0,react.useState)(parseInt(chainId).toString()),[myNfts,setMyNfts]=(0,react.useState)(null),[myStakedNfts,setMyStakedNfts]=(0,react.useState)(null),alchemySettings={apiKey:"ASzOoMdVeykRAVDqjJGP3DeQGoMVvHnX",network:index_02af91ae.N.ETH_GOERLI},alchemy=new index_02af91ae.k(alchemySettings),{loading,error,data:listedNfts}=(0,useQuery.a)(subgraphQueries.Z),checkIfListed=myNft=>{let isListed;return listedNfts.activeItems.map(item=>{item.tokenId==myNft.tokenId&&(isListed=!0)}),isListed},{runContractFunction:getTokensBalance}=(0,index_esm.JX)({abi:PrismStaking,contractAddress:prismStakingAddress,functionName:"tokensOfOwner",params:{account:account}}),updateStakedNfts=async()=>{setMyStakedNfts(await getTokensBalance())};return(0,react.useEffect)(()=>{if(isWeb3Enabled){let nftsForOwner=async()=>{console.log("alchemy key: ".concat("ASzOoMdVeykRAVDqjJGP3DeQGoMVvHnX"));let myNfts=await alchemy.nft.getNftsForOwner(account,{contractAddresses:[prismNftAddress]});console.log("myNfts: ".concat(myNfts)),setMyNfts(myNfts)};nftsForOwner().catch(console.error)}updateStakedNfts(),setChainString(parseInt(chainId).toString())},[isWeb3Enabled,chainId]),(0,jsx_runtime.jsx)("div",{className:"".concat(styles.Z.xPaddings," py-8 relative"),children:"5"!=chainString&&isWeb3Enabled?(0,jsx_runtime.jsxs)("div",{className:"flex flex-col items-center h-screen",children:[(0,jsx_runtime.jsx)("p",{className:"pt-20 text-2xl text-white",children:"Unsupported Chain."}),(0,jsx_runtime.jsxs)("p",{className:"text-white",children:["Please connect to \xa0",(0,jsx_runtime.jsx)("span",{children:(0,jsx_runtime.jsx)("button",{onClick:()=>switchNetwork("0x5"),className:"text-xl text-transparent bg-clip-text bg-gradient-to-br from-pink-400 to-red-600 font-bold",children:(0,jsx_runtime.jsx)("p",{children:"Goerli Testnet"})})})]})]}):(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("h1",{className:"flex md:justify-start justify-center py-4 px-4 font-bold text-2xl text-white",children:"My Staked Prisms"}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap",children:"5"==chainString&&isWeb3Enabled?myStakedNfts&&!loading&&listedNfts?myStakedNfts.map(nft=>(0,jsx_runtime.jsx)("div",{className:"p-2",children:(0,jsx_runtime.jsx)(StakeBox,{nftAddress:prismNftAddress,tokenId:nft.toString(),prismStakingAddress:prismStakingAddress})},"".concat(account).concat(nft.toString()))):(0,jsx_runtime.jsx)("div",{style:{backgroundColor:"#ECECFE",borderRadius:"8px",padding:"20px"},children:(0,jsx_runtime.jsx)(dist.M,{size:12,spinnerColor:"#2E7DAF",spinnerType:"wave"})}):(0,jsx_runtime.jsx)("div",{children:"Web3 Currently Not Enabled"})}),(0,jsx_runtime.jsx)("h1",{className:"flex md:justify-start justify-center py-4 pt-20 px-4 font-bold text-2xl text-white",children:"My Prisms"}),(0,jsx_runtime.jsx)("div",{className:"flex flex-wrap md:justify-start justify-center ",children:"5"==chainString&&myNfts&&isWeb3Enabled&&!loading&&myNfts.ownedNfts.map(nft=>{let isListed=checkIfListed(nft);return(0,jsx_runtime.jsx)("div",{className:"p-2",children:(0,jsx_runtime.jsx)(NFTBox.Z,{nftAddress:nft.contract.address,tokenId:nft.tokenId,marketplaceAddress:marketplaceAddress,prismStakingAddress:prismStakingAddress,isListed:isListed,isActive:!1,toStake:!0})},"".concat(isListed).concat(nft.contract.address).concat(nft.tokenId))})})]})})}}},function(__webpack_require__){__webpack_require__.O(0,[553,550,205,774,888,179],function(){return __webpack_require__(__webpack_require__.s=92567)}),_N_E=__webpack_require__.O()}]);